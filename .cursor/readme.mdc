---
alwaysApply: true
---

# ğŸ“˜ NOTEBOOKS Project Rules

> **Báº¯t buá»™c Ä‘á»c**: `.cursor/PROJECT.md` vÃ  `.cursor/ARCHITECTURE.md` Ä‘á»ƒ hiá»ƒu cáº¥u trÃºc dá»± Ã¡n.

---

## ğŸ—‚ï¸ Cáº¥u trÃºc dá»± Ã¡n

```
notebook_fe/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ (main)/                   # Layout chÃ­nh
â”‚   â”‚   â”œâ”€â”€ (admin)/              # Routes admin (/admin/*)
â”‚   â”‚   â”œâ”€â”€ (user)/               # Routes user (/notebook/*, /profile/*)
â”‚   â”‚   â”œâ”€â”€ (workspace)/          # Routes workspace (/w/*)
â”‚   â”‚   â””â”€â”€ (share)/              # Routes public share
â”‚   â”œâ”€â”€ api/                      # API routes (Next.js)
â”‚   â”œâ”€â”€ globals.css               # Global styles
â”‚   â”œâ”€â”€ layout.tsx                # Root layout
â”‚   â””â”€â”€ loading.tsx               # Global loading
â”‚
â”œâ”€â”€ components/                   # React Components
â”‚   â”œâ”€â”€ admin/                    # Admin components
â”‚   â”‚   â”œâ”€â”€ dashboard/            # Dashboard
â”‚   â”‚   â”œâ”€â”€ notebooks/            # Quáº£n lÃ½ notebooks
â”‚   â”‚   â”œâ”€â”€ org-units/            # Quáº£n lÃ½ Ä‘Æ¡n vá»‹
â”‚   â”‚   â”œâ”€â”€ users/                # Quáº£n lÃ½ users
â”‚   â”‚   â””â”€â”€ shared/               # Shared admin components
â”‚   â”‚
â”‚   â”œâ”€â”€ user/                     # User components
â”‚   â”‚   â”œâ”€â”€ notebook/             # Notebook workspace
â”‚   â”‚   â”‚   â”œâ”€â”€ workspace/        # Editor, AI features, Chat
â”‚   â”‚   â”‚   â”œâ”€â”€ available/        # Community notebooks
â”‚   â”‚   â”‚   â””â”€â”€ my-personal-groups/
â”‚   â”‚   â””â”€â”€ notifications/        # Notifications
â”‚   â”‚
â”‚   â”œâ”€â”€ shared/                   # Shared components
â”‚   â””â”€â”€ ui/                       # shadcn/ui components
â”‚
â”œâ”€â”€ api/                          # API utilities
â”‚   â”œâ”€â”€ client/                   # Client-side (axios)
â”‚   â””â”€â”€ server/                   # Server-side (fetch)
â”‚
â”œâ”€â”€ types/                        # TypeScript types
â”‚   â”œâ”€â”€ admin/                    # Admin types
â”‚   â”œâ”€â”€ user/                     # User types
â”‚   â””â”€â”€ shared/                   # Shared types
â”‚
â”œâ”€â”€ stores/                       # Zustand stores
â”œâ”€â”€ hooks/                        # Custom hooks
â”œâ”€â”€ lib/                          # Utilities
â””â”€â”€ provider/                     # Context providers
```

---

## ğŸ”Œ CÃ¡ch gá»i API

### SÆ¡ Ä‘á»“ luá»“ng dá»¯ liá»‡u

```mermaid
flowchart LR
    subgraph Frontend["Frontend (Next.js)"]
        CC["Client Component"]
        SC["Server Component"]
    end
    
    subgraph API["API Layer"]
        AX["axios (client)"]
        FT["fetcher (server)"]
    end
    
    subgraph Backend["Backend (Spring Boot)"]
        BE["REST API"]
    end
    
    CC -->|useEffect + fetch| AX
    SC -->|Server Action| FT
    AX -->|withCredentials| BE
    FT -->|Cookie AUTH-TOKEN| BE
```

### ğŸ“ Client-side API (DÃ¹ng trong `"use client"`)

```tsx
import api from "@/api/client/axios";

// âœ… Pattern chuáº©n: Component tá»± fetch trong useEffect
export default function MyComponent() {
  const [data, setData] = useState<MyType | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    loadData();
  }, []);

  const loadData = async () => {
    setIsLoading(true);
    try {
      const response = await api.get<MyType>("/user/endpoint");
      setData(response.data);
    } catch (error) {
      console.error("Error:", error);
      toast.error("KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u");
    } finally {
      setIsLoading(false);
    }
  };

  if (isLoading) return <Skeleton />;
  return <div>{data?.name}</div>;
}
```

### ğŸ“ Server-side API (DÃ¹ng trong Server Component)

```tsx
import { fetcher } from "@/api/server/fetcher";
import { cookies } from "next/headers";

// Server Component
export default async function Page() {
  const cookieStore = await cookies();
  const res = await fetcher<MyType>("/user/endpoint", cookieStore);
  const data = await res.json();
  
  return <div>{data.name}</div>;
}
```

---

## ğŸ–¥ï¸ Server Component Rules

### Khi nÃ o dÃ¹ng Server Component?

| DÃ¹ng Server Component | DÃ¹ng Client Component |
|----------------------|----------------------|
| Fetch data ban Ä‘áº§u (layout, metadata) | Interactivity (click, input, form) |
| KhÃ´ng cáº§n state/effect | Cáº§n useState, useEffect |
| SEO-critical content | Real-time updates |
| Sensitive data (tokens) | Browser APIs |

### Pattern 1: Layout vá»›i Server Fetch

```tsx
// app/(main)/(admin)/admin/layout.tsx
import { cookies } from "next/headers";
import { getServerCookie } from "@/api/server/cookieStore";
import { fetcher } from "@/api/server/fetcher";

export default async function AdminLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const stores = await cookies();
  const accessToken = getServerCookie(stores, "AUTH-TOKEN");
  
  // Fetch data cáº§n thiáº¿t cho layout
  let notifications: NotificationsPagedResponse | null = null;
  if (accessToken) {
    const res = await fetcher("/notifications?page=0&size=20", stores);
    if (res.ok) {
      notifications = await res.json();
    }
  }

  return (
    <div className="min-h-screen">
      <Sidebar />
      <main>{children}</main>
    </div>
  );
}
```

### Pattern 2: Page vá»›i Dynamic Params

```tsx
// app/(main)/(admin)/admin/users/[id]/page.tsx
interface PageProps {
  params: Promise<{ id: string }>;
}

export default async function UserDetailPage({ params }: PageProps) {
  const { id } = await params;  // âš ï¸ Next.js 15+: params lÃ  Promise
  return <UserDetail userId={id} />;
}
```

### Pattern 3: Page vá»›i Metadata

```tsx
// app/(main)/(user)/notebook/[id]/page.tsx
import type { Metadata } from "next";

interface PageProps {
  params: Promise<{ id: string }>;
}

export async function generateMetadata({ params }: PageProps): Promise<Metadata> {
  const { id } = await params;
  return {
    title: `Chi tiáº¿t Notebook`,
    description: "Xem thÃ´ng tin chi tiáº¿t notebook",
  };
}

export default async function NotebookDetailPage({ params }: PageProps) {
  const { id } = await params;
  return <NotebookDetail notebookId={id} />;
}
```

### Pattern 4: Page cáº§n Access Token

```tsx
// app/(main)/(workspace)/notebook/[id]/workspace/page.tsx
import { cookies } from "next/headers";
import { getServerCookie } from "@/api/server/cookieStore";

interface PageProps {
  params: Promise<{ id: string }>;
}

export default async function WorkspacePage({ params }: PageProps) {
  const { id } = await params;
  const stores = await cookies();
  const accessToken = getServerCookie(stores, "AUTH-TOKEN");

  return (
    <NotebookWorkspace 
      notebookId={id} 
      accessToken={accessToken || undefined} 
    />
  );
}
```

### âš ï¸ LÆ°u Ã½ quan trá»ng

| Rule | Chi tiáº¿t |
|------|----------|
| `params` lÃ  Promise | Next.js 15+: pháº£i `await params` trÆ°á»›c khi dÃ¹ng |
| `cookies()` lÃ  async | Next.js 15+: pháº£i `await cookies()` |
| KhÃ´ng dÃ¹ng hooks | Server Component khÃ´ng cÃ³ useState, useEffect |
| Truyá»n data xuá»‘ng | Fetch á»Ÿ server, truyá»n props xuá»‘ng client component |

### SÆ¡ Ä‘á»“ quyáº¿t Ä‘á»‹nh: Server vs Client

```mermaid
flowchart TD
    A[Cáº§n render component] --> B{Cáº§n interactivity?}
    B -->|CÃ³| C[Client Component]
    B -->|KhÃ´ng| D{Cáº§n fetch sensitive data?}
    D -->|CÃ³| E[Server Component]
    D -->|KhÃ´ng| F{Component Ä‘Æ¡n giáº£n?}
    F -->|CÃ³| G[Server Component]
    F -->|KhÃ´ng| C
    
    C --> H["'use client'"]
    E --> I["async function + await cookies()"]
    G --> I
```

---

## ğŸ”„ API Patterns

### Pattern 1: List vá»›i Pagination + Filter

```tsx
export default function ListComponent() {
  const [data, setData] = useState<PagedResponse<T> | null>(null);
  const [page, setPage] = useState(0);
  const [q, setQ] = useState("");
  const [sortBy, setSortBy] = useState("createdAt");
  const [sortDir, setSortDir] = useState<"asc" | "desc">("desc");

  useEffect(() => {
    loadData();
  }, [page, q, sortBy, sortDir]);

  const loadData = async () => {
    setIsLoading(true);
    try {
      const params = new URLSearchParams({
        page: page.toString(),
        size: "10",
        sortBy,
        sortDir,
        ...(q && { q }),
      });
      const response = await api.get<PagedResponse<T>>(`/endpoint?${params}`);
      setData(response.data);
    } catch (error) {
      toast.error("KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u");
    } finally {
      setIsLoading(false);
    }
  };

  // ... render
}
```

### Pattern 2: Detail vá»›i ID

```tsx
export default function DetailComponent({ id }: { id: string }) {
  const [data, setData] = useState<DetailType | null>(null);

  useEffect(() => {
    const loadDetail = async () => {
      try {
        const response = await api.get<DetailType>(`/endpoint/${id}`);
        setData(response.data);
      } catch (error) {
        toast.error("KhÃ´ng thá»ƒ táº£i thÃ´ng tin");
      }
    };
    loadDetail();
  }, [id]);

  // ... render
}
```

### Pattern 3: Create/Update Form

```tsx
export default function FormComponent() {
  const [isLoading, setIsLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    try {
      await api.post("/endpoint", formData);
      toast.success("Táº¡o thÃ nh cÃ´ng");
      router.push("/list");
    } catch (error) {
      toast.error("KhÃ´ng thá»ƒ táº¡o");
    } finally {
      setIsLoading(false);
    }
  };

  // ... render form
}
```

---

## âš¡ NguyÃªn táº¯c cá»‘t lÃµi

| # | Quy táº¯c | MÃ´ táº£ |
|---|---------|-------|
| 1 | **ÄÆ¡n giáº£n lÃ  vua** | Code pháº£i dá»… hiá»ƒu nháº¥t cÃ³ thá»ƒ, khÃ´ng phá»©c táº¡p, khÃ´ng over-engineer |
| 2 | **Tá»± quáº£n lÃ½ logic** | Má»—i component tá»± fetch, tá»± quáº£n state, khÃ´ng truyá»n props lung tung |
| 3 | **Props tá»‘i Ä‘a 3** | KhÃ´ng bao giá» truyá»n quÃ¡ 3 props vÃ o component |
| 4 | **Component â‰¤ 150 dÃ²ng** | Náº¿u dÃ i hÆ¡n â†’ tÃ¡ch ngay |

---

## ğŸ› ï¸ Tech Stack

| CÃ´ng nghá»‡ | Version | Ghi chÃº |
|-----------|---------|---------|
| Next.js | 16+ | App Router only |
| React | 19+ | Server Component Æ°u tiÃªn |
| TailwindCSS | Latest | KhÃ´ng config phá»©c táº¡p |
| shadcn/ui | Latest | **UI library duy nháº¥t** |

---

## ğŸ¨ UI/UX Rules

### âœ… Báº®T BUá»˜C

```
shadcn/ui = 100% UI components
```

- **Táº¥t cáº£** component UI pháº£i tá»« shadcn/ui
- Náº¿u cáº§n customize â†’ copy vÃ o `components/ui/` vÃ  chá»‰nh sá»­a
- Kiá»ƒm tra shadcn/ui docs **TRÆ¯á»šC** khi code

---

## âœ¨ DESIGN EXCELLENCE â€” Giao diá»‡n pháº£i SIÃŠU Äáº¸P

> âš ï¸ **QUAN TRá»ŒNG**: Giao diá»‡n pháº£i Ä‘áº¡t chuáº©n nhÆ° cÃ¡c web ná»•i tiáº¿ng dÃ¹ng shadcn/ui: **Vercel, Cal.com, Resend, Dub.co, Supabase Dashboard**

### ğŸ¯ TiÃªu chuáº©n thiáº¿t káº¿

| TiÃªu chÃ­ | YÃªu cáº§u |
|----------|---------|
| **First Impression** | User pháº£i "WOW" ngay láº§n Ä‘áº§u nhÃ¬n tháº¥y |
| **Premium Feel** | Giao diá»‡n pháº£i cÃ³ cáº£m giÃ¡c cao cáº¥p, professional |
| **Attention to Detail** | Tá»«ng pixel pháº£i Ä‘Æ°á»£c chÄƒm chÃºt |
| **Consistency** | Nháº¥t quÃ¡n xuyÃªn suá»‘t toÃ n bá»™ app |

### ğŸ–Œï¸ Visual Design Principles

```
1. SPACING â€” Generous whitespace, khÃ´ng cháº­t chá»™i
2. TYPOGRAPHY â€” Font hierarchy rÃµ rÃ ng, readable
3. CONTRAST â€” Äá»§ contrast Ä‘á»ƒ dá»… Ä‘á»c
4. BALANCE â€” Layout cÃ¢n Ä‘á»‘i, khÃ´ng lá»‡ch
5. RHYTHM â€” Consistent spacing system (4px, 8px, 12px, 16px, 24px, 32px, 48px)
```

### ğŸ’ Premium UI Patterns

| Pattern | CÃ¡ch dÃ¹ng |
|---------|-----------|
| **Subtle borders** | `border-border/50` hoáº·c `border-muted` â€” khÃ´ng border quÃ¡ Ä‘áº­m |
| **Soft backgrounds** | `bg-muted/50`, `bg-accent/5` â€” ná»n nháº¹ nhÃ ng |
| **Smooth transitions** | `transition-all duration-200` â€” mÆ°á»£t mÃ  |
| **Micro-interactions** | Hover states tinh táº¿, khÃ´ng quÃ¡ lá»‘ |
| **Glass morphism** | `backdrop-blur-sm bg-background/80` khi cáº§n |
| **Rounded corners** | Consistent radius: `rounded-lg` hoáº·c `rounded-xl` |

### ğŸŒ— Dark Mode Excellence

- Dark mode pháº£i **Ä‘áº¹p nhÆ° light mode**, khÃ´ng chá»‰ "Ä‘á»•i mÃ u"
- MÃ u ná»n tá»‘i: `hsl(0 0% 3.9%)` hoáº·c gáº§n Ä‘Ã³ â€” khÃ´ng Ä‘en tuyá»‡t Ä‘á»‘i
- Contrast pháº£i Ä‘á»§ nhÆ°ng khÃ´ng chÃ³i máº¯t
- Borders vÃ  dividers pháº£i nhÃ¬n rÃµ nhÆ°ng subtle

### ğŸ“ Layout & Spacing

```tsx
// âœ… ÄÃšNG â€” Generous spacing
<div className="space-y-6 p-6">
  <Card className="p-6">
    <CardHeader className="pb-4">...</CardHeader>
    <CardContent className="space-y-4">...</CardContent>
  </Card>
</div>

// âŒ SAI â€” Cháº­t chá»™i
<div className="space-y-2 p-2">
  <Card className="p-2">...</Card>
</div>
```

### ğŸ”¤ Typography

| Element | Class | Size |
|---------|-------|------|
| Page title | `text-3xl font-bold tracking-tight` | 30px |
| Section title | `text-xl font-semibold` | 20px |
| Card title | `text-lg font-medium` | 18px |
| Body | `text-sm text-muted-foreground` | 14px |
| Caption | `text-xs text-muted-foreground` | 12px |

### ğŸ­ States & Feedback

| State | Styling |
|-------|---------|
| Hover | Subtle background change, smooth transition |
| Focus | Clear focus ring, accessible |
| Active | Slightly pressed effect |
| Loading | Skeleton hoáº·c spinner, khÃ´ng Ä‘á»ƒ trá»‘ng |
| Empty | Friendly empty state vá»›i icon + message |
| Error | Red accent, clear error message |

### ğŸ–¼ï¸ Láº¥y cáº£m há»©ng tá»«

- **Vercel Dashboard** â€” Clean, minimal, professional
- **Cal.com** â€” Modern scheduling UI
- **Resend** â€” Email platform vá»›i UI tinh táº¿
- **Dub.co** â€” Link management vá»›i dark mode Ä‘áº¹p
- **Linear** â€” Issue tracking vá»›i attention to detail
- **Raycast** â€” Command palette experience

---

## ğŸ¨ MÃ u sáº¯c

| MÃ u | Sá»­ dá»¥ng |
|-----|---------|
| `black/white/gray` | MÃ u chá»§ Ä‘áº¡o â€” **DUY NHáº¤T** |
| `red` | XÃ³a, hÃ nh Ä‘á»™ng nguy hiá»ƒm |
| `yellow` | Cáº£nh bÃ¡o |

> âš ï¸ **KHÃ”NG** dÃ¹ng báº¥t ká»³ mÃ u nÃ o khÃ¡c. KhÃ´ng xanh, khÃ´ng tÃ­m, khÃ´ng gradient mÃ u mÃ¨.

### ğŸ–¼ï¸ Style

- **Giao diá»‡n**: Premium, polished, professional
- **Responsive**: Mobile-first â€” báº¯t buá»™c
- **Animation**: Subtle, purposeful â€” khÃ´ng lá»‘
- **Shadow**: Ráº¥t nháº¹ náº¿u cáº§n, trÃ¡nh shadow náº·ng
- **Focus/Hover**: Pháº£i cÃ³ feedback rÃµ rÃ ng, mÆ°á»£t mÃ 

---

## ğŸ“ Coding Standards

### Naming Convention

| Loáº¡i | Format | VÃ­ dá»¥ |
|------|--------|-------|
| File | `kebab-case.tsx` | `user-profile.tsx` |
| Component | `PascalCase` | `UserProfile` |
| Hook | `useXxx` | `useAuth` |
| Type/Interface | `PascalCase` | `UserData` |
| Constant | `UPPER_SNAKE_CASE` | `API_BASE_URL` |

### TypeScript

```typescript
// âœ… ÄÃšNG â€” Interface trong cÃ¹ng file component
interface UserResponse {
  id: string;
  fullName: string;
  email: string;
}

export default function UserProfile() {
  const [user, setUser] = useState<UserResponse | null>(null);
  // ...
}

// âŒ SAI - khÃ´ng dÃ¹ng any
const data: any = fetchData();
```

- **LuÃ´n** Ä‘á»‹nh nghÄ©a type rÃµ rÃ ng
- **KhÃ´ng** dÃ¹ng `any` trá»« khi báº¥t kháº£ khÃ¡ng
- **Interface riÃªng** cho API response â€” Ä‘áº·t trong cÃ¹ng file component, khÃ´ng tÃ¡ch file riÃªng

---

## ğŸ“¦ Component Structure

### ÄÃºng cÃ¡ch

```tsx
// âœ… Component tá»± quáº£n lÃ½ logic
export default function CourseInfo() {
  const [course, setCourse] = useState<Course | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  
  useEffect(() => {
    const load = async () => {
      try {
        const res = await api.get<Course>("/course");
        setCourse(res.data);
      } finally {
        setIsLoading(false);
      }
    };
    load();
  }, []);
  
  if (isLoading) return <Skeleton />;
  return <div>{course?.title}</div>;
}
```

### Sai cÃ¡ch

```tsx
// âŒ Logic á»Ÿ parent, truyá»n props xuá»‘ng
export function Parent() {
  const [course, setCourse] = useState<Course | null>(null);
  const [lecturer, setLecturer] = useState<Lecturer | null>(null);
  const [discount, setDiscount] = useState<Discount | null>(null);
  // ... nhiá»u state á»Ÿ Ä‘Ã¢y
  
  return (
    <CourseInfo 
      course={course} 
      lecturer={lecturer} 
      discount={discount}
      // ... quÃ¡ nhiá»u props âŒ
    />
  );
}
```

---

## ğŸš€ Performance

| Rule | Chi tiáº¿t |
|------|----------|
| Server Component | Máº·c Ä‘á»‹nh, chá»‰ `"use client"` khi cáº§n interactivity |
| Loading | DÃ¹ng `Suspense` + `Skeleton` cho fetch cháº­m |
| Re-render | Tá»‘i thiá»ƒu hÃ³a, khÃ´ng re-render vÃ´ nghÄ©a |
| Libraries | KhÃ´ng thÃªm lib náº·ng (moment, lodash, axios...). DÃ¹ng native fetch cho server |

---

## ğŸš« Cáº¤M TUYá»†T Äá»I

| âŒ Cáº¥m | LÃ½ do |
|--------|-------|
| CSS thuáº§n, SCSS, styled-components | Chá»‰ dÃ¹ng TailwindCSS |
| next-intl, i18n | KhÃ´ng cáº§n Ä‘a ngÃ´n ngá»¯ |
| Redux, Recoil, Context phá»©c táº¡p | State Ä‘Æ¡n giáº£n, local |
| MÃ u khÃ¡c ngoÃ i Ä‘en/tráº¯ng/xÃ¡m/red/yellow | TuÃ¢n thá»§ design system |
| HOC, wrapper vÃ´ nghÄ©a | Giá»¯ code Ä‘Æ¡n giáº£n |
| Tá»± táº¡o UI component tá»« Ä‘áº§u | shadcn/ui only |
| UI library khÃ¡c (MUI, Ant, Chakra) | shadcn/ui only |
| Shadow náº·ng | Thiáº¿t káº¿ flat/subtle |
| TÃ¡ch file API riÃªng | Fetch trá»±c tiáº¿p trong component |
| Props > 3 | TÃ¡ch component |
| Giao diá»‡n xáº¥u, lÆ°á»i thiáº¿t káº¿ | **KHÃ”NG CHáº¤P NHáº¬N** |

---

## ğŸ“‹ Checklist trÆ°á»›c khi commit

### Code Quality
- [ ] Code â‰¤ 150 dÃ²ng má»—i component
- [ ] Props â‰¤ 3 má»—i component  
- [ ] KhÃ´ng cÃ³ `any` trong TypeScript
- [ ] Loading state cÃ³ skeleton
- [ ] KhÃ´ng import lib náº·ng
- [ ] Interface Ä‘áº·t trong cÃ¹ng file component

### Design Quality
- [ ] Giao diá»‡n Ä‘áº¹p nhÆ° Vercel/Cal.com level
- [ ] Spacing generous, khÃ´ng cháº­t
- [ ] Typography hierarchy rÃµ rÃ ng
- [ ] Hover/focus states smooth
- [ ] Dark mode Ä‘áº¹p nhÆ° light mode
- [ ] Responsive hoáº¡t Ä‘á»™ng
- [ ] Chá»‰ dÃ¹ng mÃ u Ä‘en/tráº¯ng/xÃ¡m (+ red/yellow khi cáº§n)
- [ ] UI 100% tá»« shadcn/ui

---

## ğŸ’¡ TÃ³m táº¯t

> **"ÄÆ¡n giáº£n. Äen tráº¯ng. shadcn/ui. Premium nhÆ° Vercel."**

```
Code = Simple, Clean, Maintainable
UI = Beautiful, Polished, Professional
UX = Fast, Smooth, Delightful
```